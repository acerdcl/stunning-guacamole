<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>能力卡牌大作战</title>
    <!-- 引入外部资源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.13.0/dist/av-min.js"></script>
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        dark: '#1F2937',
                        light: '#F9FAFB'
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .card-hover {
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-4px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            }
            .star-pulse {
                animation: pulse 0.3s ease;
            }
            .update-indicator {
                animation: fade 2s ease;
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.3); }
                100% { transform: scale(1); }
            }
            @keyframes fade {
                0% { opacity: 0; }
                50% { opacity: 1; }
                100% { opacity: 0; }
            }
            .refreshing {
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <!-- 顶部导航 -->
    <header class="bg-primary text-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold">
                <i class="fa fa-gamepad mr-2"></i>能力卡牌大作战
            </h1>
            <div class="flex items-center">
                <span id="star-count" class="bg-accent px-3 py-1 rounded-full font-bold mr-2 text-sm md:text-base">
                    剩余星星: <span id="remaining-stars">10</span>
                </span>
                <span id="vote-status" class="hidden text-sm bg-green-500 px-2 py-1 rounded">
                    <i class="fa fa-check"></i> 已完成投票
                </span>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-6">
        <!-- 游戏说明 -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <h2 class="text-lg md:text-xl font-semibold mb-2 text-dark">游戏规则</h2>
            <p class="text-gray-600">你有10颗星星，用于兑换你最想掌握的电商通用能力。点击卡牌上的星星来分配你的星星（最多5颗/卡牌），总数量不能超过10颗。提交后将实时显示班级排行榜。</p>
        </div>
        
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- 卡牌区域 -->
            <div class="lg:w-2/3">
                <h2 class="text-lg md:text-xl font-semibold mb-4 text-dark flex items-center">
                    <i class="fa fa-th-large mr-2 text-primary"></i>能力卡牌库
                </h2>
                <div id="cards-container" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                    <!-- 卡牌将通过JS动态生成 -->
                </div>
                
                <div class="mt-6 text-center">
                    <button id="submit-vote" class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-8 rounded-full shadow-md disabled:opacity-50 disabled:cursor-not-allowed transition-all" disabled>
                        <i class="fa fa-paper-plane mr-2"></i>提交我的选择
                    </button>
                </div>
            </div>
            
            <!-- 排行榜区域 - 支持下拉刷新 -->
            <div class="lg:w-1/3">
                <div class="bg-white rounded-lg shadow-md p-4 sticky top-4" id="ranking-container">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg md:text-xl font-semibold text-dark flex items-center">
                            <i class="fa fa-trophy mr-2 text-accent"></i>实时排行榜
                        </h2>
                        <span id="update-status" class="text-xs text-gray-500 hidden">
                            <i class="fa fa-refresh refreshing"></i> 更新中...
                        </span>
                        <span id="last-update" class="text-xs text-gray-500">
                            最后更新: 刚刚
                        </span>
                    </div>
                    <div id="pull-to-refresh" class="text-center py-2 text-xs text-gray-400">
                        下拉可刷新
                    </div>
                    <div id="ranking-list" class="space-y-2 max-h-[500px] overflow-y-auto pr-2">
                        <div class="flex justify-center items-center h-40 text-gray-400">
                            <p>加载排行榜中...</p>
                        </div>
                    </div>
                    <div id="update-indicator" class="hidden text-center text-xs text-green-500 mt-2 update-indicator">
                        <i class="fa fa-arrow-circle-down"></i> 数据已更新
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white mt-10 py-6">
        <div class="container mx-auto px-4 text-center">
            <p>Copyright © 2025 by 电商杜老师</p>
        </div>
    </footer>

    <!-- 投票成功弹窗 -->
    <div id="success-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white-white-white-white rounded-white rounded-lg p-6 max-w-md w-full w-full mx-4 text-center">
            <div class="text-5xl text-green-500 mb-4">
                <i class="fa fa-check-circle"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">投票成功！</h3>
            <p class="text-gray-600 mb-4">你的投票已被记录，排行榜已更新</p>
            <button id="close-modal" class="bg-primary hover:bg-primary/90 text-white font-bold py-2 px-6 rounded-full">
                确定
            </button>
        </div>
    </div>

    <script>
        // 30个电商通用能力及对应的图标
        const skills = [
            { name: "Excel", icon: "fa-table", color: "bg-green-500" },
            { name: "Premiere", icon: "fa-film", color: "bg-purple-500" },
            { name: "Python基础", icon: "fa-code", color: "bg-blue-500" },
            { name: "谈判", icon: "fa-handshake-o", color: "bg-yellow-500" },
            { name: "写文案", icon: "fa-pencil", color: "bg-red-500" },
            { name: "数据分析", icon: "fa-bar-chart", color: "bg-teal-500" },
            { name: "Photoshop", icon: "fa-picture-o", color: "bg-pink-500" },
            { name: "PPT制作", icon: "fa-file-powerpoint-o", color: "bg-orange-500" },
            { name: "市场调研", icon: "fa-search", color: "bg-indigo-500" },
            { name: "SEO优化", icon: "fa-search-plus", color: "bg-cyan-500" },
            { name: "视频剪辑", icon: "fa-video-camera", color: "bg-red-600" },
            { name: "公众号运营", icon: "fa-wechat", color: "bg-green-600" },
            { name: "直播技巧", icon: "fa-microphone", color: "bg-purple-600" },
            { name: "用户研究", icon: "fa-users", color: "bg-blue-600" },
            { name: "竞品分析", icon: "fa-eye", color: "bg-yellow-600" },
            { name: "UI设计", icon: "fa-desktop", color: "bg-gray-500" },
            { name: "SQL", icon: "fa-database", color: "bg-amber-500" },
            { name: "短视频策划", icon: "fa-lightbulb-o", color: "bg-lime-500" },
            { name: "电商运营", icon: "fa-shopping-cart", color: "bg-pink-600" },
            { name: "社群运营", icon: "fa-comments", color: "bg-teal-600" },
            { name: "供应链管理", icon: "fa-truck", color: "bg-slate-500" },
            { name: "跨境电商", icon: "fa-globe", color: "bg-fuchsia-500" },
            { name: "内容创作", icon: "fa-paint-brush", color: "bg-rose-500" },
            { name: "活动策划", icon: "fa-calendar-check-o", color: "bg-emerald-500" },
            { name: "品牌推广", icon: "fa-bullhorn", color: "bg-violet-500" },
            { name: "客户关系", icon: "fa-heart", color: "bg-rose-600" },
            { name: "产品经理", icon: "fa-cubes", color: "bg-cyan-600" },
            { name: "数据可视化", icon: "fa-line-chart", color: "bg-blue-700" },
            { name: "新媒体营销", icon: "fa-share-alt", color: "bg-purple-700" },
            { name: "转化率优化", icon: "fa-rocket", color: "bg-red-700" }
        ];

        // 全局变量
        let voteData = {};
        let remainingStars = 10;
        let hasVoted = false;
        let userId = localStorage.getItem('skillCardUserId');
        let Vote; // LeanCloud Vote类
        let subscription; // 实时订阅对象
        let lastUpdateTime = new Date(); // 最后更新时间
        let isRefreshing = false; // 是否正在刷新
        
        // 下拉刷新相关变量
        let startY = 0;
        let currentY = 0;
        let isDragging = false;
        const refreshThreshold = 60; // 触发刷新的下拉距离

        // 初始化用户ID
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('skillCardUserId', userId);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 立即生成卡牌
            generateCards();
            
            // 初始化LeanCloud
            initLeanCloud();
            
            // 绑定事件
            document.getElementById('submit-vote').addEventListener('click', submitVote);
            document.getElementById('close-modal').addEventListener('click', () => {
                document.getElementById('success-modal').classList.add('hidden');
            });
            
            // 初始化下拉刷新
            initPullToRefresh();
        });

        // 生成能力卡牌
        function generateCards() {
            const container = document.getElementById('cards-container');
            container.innerHTML = ''; // 清空容器
            
            // 初始化投票数据
            skills.forEach(skill => {
                voteData[skill.name] = 0;
            });
            
            // 创建每张卡牌
            skills.forEach(skill => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md p-4 card-hover';
                card.innerHTML = `
                    <div class="flex flex-col items-center">
                        <div class="w-14 h-14 rounded-full flex items-center justify-center mb-3 ${skill.color} text-white">
                            <i class="fa ${skill.icon} text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-lg mb-3 text-center">${skill.name}</h3>
                        <div class="flex justify-between items-center w-full">
                            <div class="stars-container flex">
                                ${[1, 2, 3, 4, 5].map(value => `
                                    <i class="fa fa-star text-gray-300 cursor-pointer text-xl mx-0.5 transition-all" 
                                       data-skill="${skill.name}" 
                                       data-value="${value}"></i>
                                `).join('')}
                            </div>
                            <span class="vote-count bg-gray-100 px-2 py-1 rounded text-sm">
                                <i class="fa fa-star text-accent"></i> <span>0</span>
                            </span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
            
            // 绑定星星点击事件
            bindStarClickEvents();
        }

        // 绑定星星点击事件
        function bindStarClickEvents() {
            // 先移除可能存在的旧事件监听
            document.querySelectorAll('.stars-container i').forEach(star => {
                star.removeEventListener('click', handleStarClick);
            });
            
            // 绑定新的事件监听
            document.querySelectorAll('.stars-container i').forEach(star => {
                star.addEventListener('click', handleStarClick);
                star.addEventListener('mouseover', function() {
                    if (!hasVoted) {
                        this.classList.add('text-accent');
                    }
                });
                star.addEventListener('mouseout', function() {
                    if (!hasVoted && !this.classList.contains('star-active')) {
                        this.classList.remove('text-accent');
                    }
                });
            });
        }

        // 处理星星点击事件
        function handleStarClick(e) {
            e.stopPropagation();
            
            if (hasVoted) return;
            
            const skill = e.target.dataset.skill;
            const value = parseInt(e.target.dataset.value);
            const stars = document.querySelectorAll(`.stars-container i[data-skill="${skill}"]`);
            
            // 计算之前的投票数
            const previousVotes = voteData[skill] || 0;
            const difference = value - previousVotes;
            
            // 检查是否有足够的星星
            if (remainingStars - difference >= 0) {
                // 更新剩余星星数量
                remainingStars -= difference;
                document.getElementById('remaining-stars').textContent = remainingStars;
                
                // 更新投票数据
                voteData[skill] = value;
                
                // 更新星星显示状态
                stars.forEach((star, index) => {
                    if (index < value) {
                        star.classList.add('text-accent', 'star-active');
                        star.classList.remove('text-gray-300');
                        if (index === value - 1) {
                            star.classList.add('star-pulse');
                            setTimeout(() => star.classList.remove('star-pulse'), 300);
                        }
                    } else {
                        star.classList.remove('text-accent', 'star-active');
                        star.classList.add('text-gray-300');
                    }
                });
                
                // 更新卡片上的计数
                const countElement = e.target.closest('.card-hover').querySelector('.vote-count span');
                countElement.textContent = value;
                
                // 更新提交按钮状态
                document.getElementById('submit-vote').disabled = remainingStars === 10;
            } else {
                // 星星抖动动画提示
                e.target.classList.add('animate-bounce');
                setTimeout(() => e.target.classList.remove('animate-bounce'), 500);
            }
        }

        // 初始化LeanCloud
        function initLeanCloud() {
            try {
                AV.init({
                    appId: "uJ3KsasvmBzf9Xn2OodGclFx-gzGzoHsz",
                    appKey: "JEsdiH1q5v1NzqyLCLqJVWvt",
                    serverURLs: "https://uj3ksasv.lc-cn-n1-shared.com"
                });
                
                // 创建Vote类
                Vote = AV.Object.extend('Vote');
                
                // 检查用户是否已投票
                checkIfVoted();
                
                // 加载并监听投票数据
                loadAndWatchVotes();
                
                // 启动轮询作为实时推送的备份
                startPolling();
                
            } catch (error) {
                console.error('LeanCloud初始化失败:', error);
                alert('数据服务初始化失败，部分功能可能无法使用');
                // 即使初始化失败，也尝试加载一次数据
                setTimeout(manualRefresh, 1000);
            }
        }

        // 加载并监听投票数据
        function loadAndWatchVotes() {
            if (!Vote) return;
            
            const query = new AV.Query(Vote);
            
            try {
                // 先取消可能存在的旧订阅
                if (subscription) {
                    subscription.unsubscribe();
                }
                
                // 实时监听数据变化
                subscription = query.subscribe();
                
                // 初始加载数据
                loadVoteData(query);
                
                // 数据更新时重新加载 - 增强版事件监听
                subscription.on('create', (object) => {
                    console.log('检测到新投票:', object.get('skill'));
                    triggerRefresh();
                });
                subscription.on('update', (object) => {
                    console.log('检测到投票更新:', object.get('skill'));
                    triggerRefresh();
                });
                subscription.on('error', (error) => {
                    console.error('实时订阅错误:', error);
                    // 错误后尝试重新订阅
                    setTimeout(loadAndWatchVotes, 5000);
                });
                
            } catch (error) {
                console.error('设置数据监听失败:', error);
                // 失败后仍尝试加载一次数据
                loadVoteData(query);
            }
        }

        // 启动轮询作为备份
        function startPolling() {
            // 每15秒自动刷新一次，作为实时推送的备份
            setInterval(() => {
                if (!isRefreshing) {
                    console.log('定时刷新数据');
                    manualRefresh();
                }
            }, 15000);
        }

        // 触发刷新并显示提示
        function triggerRefresh() {
            if (!isRefreshing) {
                manualRefresh().then(() => {
                    // 显示更新提示
                    const indicator = document.getElementById('update-indicator');
                    indicator.classList.remove('hidden');
                    indicator.classList.add('update-indicator');
                    setTimeout(() => {
                        indicator.classList.add('hidden');
                        indicator.classList.remove('update-indicator');
                    }, 3000);
                });
            }
        }

        // 手动刷新数据
        function manualRefresh() {
            return new Promise((resolve) => {
                if (!Vote || isRefreshing) {
                    resolve();
                    return;
                }
                
                isRefreshing = true;
                document.getElementById('update-status').classList.remove('hidden');
                
                const query = new AV.Query(Vote);
                loadVoteData(query).then(() => {
                    // 更新最后更新时间
                    lastUpdateTime = new Date();
                    updateLastTimeDisplay();
                    
                    isRefreshing = false;
                    document.getElementById('update-status').classList.add('hidden');
                    resolve();
                }).catch(() => {
                    isRefreshing = false;
                    document.getElementById('update-status').classList.add('hidden');
                    resolve();
                });
            });
        }

        // 更新最后更新时间显示
        function updateLastTimeDisplay() {
            const now = new Date();
            const diffSeconds = Math.floor((now - lastUpdateTime) / 1000);
            
            let displayText;
            if (diffSeconds < 60) {
                displayText = `最后更新: ${diffSeconds}秒前`;
            } else if (diffSeconds < 3600) {
                displayText = `最后更新: ${Math.floor(diffSeconds / 60)}分钟前`;
            } else {
                displayText = `最后更新: ${Math.floor(diffSeconds / 3600)}小时前`;
            }
            
            document.getElementById('last-update').textContent = displayText;
        }

        // 加载投票数据并更新排行榜
        function loadVoteData(query) {
            return new Promise((resolve, reject) => {
                if (!query) {
                    resolve();
                    return;
                }
                
                query.find().then(results => {
                    // 计算每个技能的总得票数
                    const skillScores = {};
                    skills.forEach(skill => {
                        skillScores[skill.name] = 0;
                    });
                    
                    results.forEach(vote => {
                        const skill = vote.get('skill');
                        const stars = vote.get('stars') || 0;
                        if (skillScores[skill] !== undefined) {
                            skillScores[skill] += stars;
                        }
                    });
                    
                    // 更新排行榜和卡牌显示
                    updateRanking(skillScores);
                    updateCardScores(skillScores);
                    resolve();
                }).catch(error => {
                    console.error('加载投票数据失败:', error);
                    reject(error);
                });
            });
        }

        // 初始化下拉刷新功能
        function initPullToRefresh() {
            const container = document.getElementById('ranking-container');
            const refreshHint = document.getElementById('pull-to-refresh');
            const rankingList = document.getElementById('ranking-list');
            
            // 触摸开始
            container.addEventListener('touchstart', (e) => {
                // 只有在列表顶部时才允许下拉刷新
                if (rankingList.scrollTop <= 0) {
                    startY = e.touches[0].clientY;
                    isDragging = true;
                }
            }, { passive: true });
            
            // 触摸移动
            container.addEventListener('touchmove', (e) => {
                if (isDragging && rankingList.scrollTop <= 0) {
                    currentY = e.touches[0].clientY;
                    const diff = currentY - startY;
                    
                    // 限制下拉距离
                    if (diff > 0) {
                        e.preventDefault(); // 阻止页面滚动
                        const pullDistance = Math.min(diff, refreshThreshold + 20);
                        refreshHint.style.height = `${pullDistance}px`;
                        
                        // 改变提示文本
                        if (pullDistance >= refreshThreshold) {
                            refreshHint.innerHTML = '<i class="fa fa-refresh refreshing"></i> 松开刷新';
                        } else {
                            refreshHint.textContent = '下拉可刷新';
                        }
                    }
                }
            }, { passive: false });
            
            // 触摸结束
            container.addEventListener('touchend', () => {
                if (isDragging) {
                    const diff = currentY - startY;
                    
                    // 检查是否达到刷新阈值
                    if (diff >= refreshThreshold) {
                        refreshHint.innerHTML = '<i class="fa fa-refresh refreshing"></i> 刷新中...';
                        manualRefresh().then(() => {
                            // 刷新完成后恢复状态
                            refreshHint.style.height = 'auto';
                            refreshHint.textContent = '下拉可刷新';
                        });
                    } else {
                        // 未达到阈值，恢复状态
                        refreshHint.style.height = 'auto';
                    }
                    
                    isDragging = false;
                    startY = 0;
                    currentY = 0;
                }
            }, { passive: true });
            
            // 为桌面端添加刷新按钮功能
            document.getElementById('last-update').addEventListener('click', manualRefresh);
        }

        // 检查用户是否已投票
        function checkIfVoted() {
            if (!Vote) return;
            
            const query = new AV.Query(Vote);
            query.equalTo('userId', userId);
            query.find().then(results => {
                if (results.length > 0) {
                    hasVoted = true;
                    disableVoting();
                }
            }).catch(error => {
                console.error('检查投票状态失败:', error);
            });
        }

        // 禁用投票功能
        function disableVoting() {
            document.getElementById('star-count').classList.add('hidden');
            document.getElementById('vote-status').classList.remove('hidden');
            
            document.querySelectorAll('.stars-container i').forEach(star => {
                star.classList.remove('cursor-pointer', 'star-active');
                star.classList.add('opacity-70');
            });
            
            document.getElementById('submit-vote').disabled = true;
        }

        // 提交投票
        function submitVote() {
            if (!Vote || hasVoted || remainingStars >= 10) return;
            
            const votePromises = [];
            
            // 收集所有投票
            skills.forEach(skill => {
                if (voteData[skill.name] > 0) {
                    const vote = new Vote();
                    vote.set('userId', userId);
                    vote.set('skill', skill.name);
                    vote.set('stars', voteData[skill.name]);
                    votePromises.push(vote.save());
                }
            });
            
            // 批量保存
            if (votePromises.length > 0) {
                document.getElementById('submit-vote').disabled = true;
                document.getElementById('submit-vote').innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>提交中...';
                
                Promise.all(votePromises).then(() => {
                    hasVoted = true;
                    disableVoting();
                    document.getElementById('success-modal').classList.remove('hidden');
                    // 提交后主动刷新数据
                    manualRefresh();
                }).catch(error => {
                    console.error('提交投票失败:', error);
                    alert('提交失败，请重试');
                    document.getElementById('submit-vote').disabled = false;
                    document.getElementById('submit-vote').innerHTML = '<i class="fa fa-paper-plane mr-2"></i>提交我的选择';
                });
            }
        }

        // 更新排行榜
        function updateRanking(skillScores) {
            const rankingList = document.getElementById('ranking-list');
            
            // 排序技能（从高到低）
            const sortedSkills = Object.entries(skillScores)
                .sort((a, b) => b[1] - a[1]);
            
            // 清空排行榜
            rankingList.innerHTML = '';
            
            // 无数据时的显示
            if (sortedSkills.length === 0 || sortedSkills[0][1] === 0) {
                rankingList.innerHTML = `
                    <div class="flex justify-center items-center h-40 text-gray-400">
                        <p>暂无投票数据，成为第一个投票的人吧！</p>
                    </div>
                `;
                return;
            }
            
            // 生成排行榜项
            sortedSkills.forEach(([skill, score], index) => {
                const item = document.createElement('div');
                let rankClass = '';
                let rankIcon = '';
                
                // 前三名样式
                if (index === 0) {
                    rankClass = 'bg-yellow-50 border-yellow-200';
                    rankIcon = '<i class="fa fa-trophy text-yellow-500 mr-2"></i>';
                } else if (index === 1) {
                    rankClass = 'bg-gray-50 border-gray-200';
                    rankIcon = '<i class="fa fa-trophy text-gray-400 mr-2"></i>';
                } else if (index === 2) {
                    rankClass = 'bg-orange-50 border-orange-200';
                    rankIcon = '<i class="fa fa-trophy text-orange-600 mr-2"></i>';
                } else {
                    rankClass = 'bg-white border-gray-100';
                    rankIcon = `<span class="text-gray-500 mr-2">${index + 1}.</span>`;
                }
                
                item.className = `flex justify-between items-center p-2 rounded-lg border ${rankClass}`;
                item.innerHTML = `
                    <div class="flex items-center">
                        ${rankIcon}
                        <span class="font-medium">${skill}</span>
                    </div>
                    <div class="flex items-center text-accent font-bold">
                        <i class="fa fa-star mr-1"></i> ${score}
                    </div>
                `;
                rankingList.appendChild(item);
            });
        }

        // 更新卡片上的总票数
        function updateCardScores(skillScores) {
            document.querySelectorAll('#cards-container > div').forEach(card => {
                const skill = card.querySelector('h3').textContent;
                const score = skillScores[skill] || 0;
                const countElement = card.querySelector('.vote-count span');
                countElement.textContent = score;
            });
        }
    </script>
</body>
</html>
    

