<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>能力卡牌大作战</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7C3AED', // 主色调：紫色
                        secondary: '#F59E0B', // 辅助色：橙色（星星/重点）
                        accent: '#10B981', // 强调色：绿色（按钮）
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        game: ['"Press Start 2P"', 'cursive', 'sans-serif'],
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'shine': 'shine 1.5s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        shine: {
                            '0%, 100%': { boxShadow: '0 0 15px rgba(245, 158, 11, 0.6)' },
                            '50%': { boxShadow: '0 0 25px rgba(245, 158, 11, 0.9)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 4px 20px rgba(124, 58, 237, 0.2);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px) scale(1.02);
                box-shadow: 0 8px 30px rgba(124, 58, 237, 0.3);
            }
            .star-active {
                color: #F59E0B;
                text-shadow: 0 0 10px rgba(245, 158, 11, 0.8);
            }
            .rank-item {
                transition: all 0.5s ease;
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }
            .card-disabled {
                filter: grayscale(0.7);
                opacity: 0.7;
                pointer-events: none;
            }
        }
    </style>
    
    <!-- 引入游戏风格字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-purple-900 to-indigo-900 min-h-screen text-gray-100 font-sans">
    <!-- 背景装饰 -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none opacity-10">
        <div class="absolute -top-40 -left-40 w-96 h-96 bg-purple-500 rounded-full blur-3xl"></div>
        <div class="absolute top-1/3 -right-20 w-80 h-80 bg-yellow-500 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-1/4 w-96 h-96 bg-green-500 rounded-full blur-3xl"></div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-7xl relative z-10">
        <!-- 游戏标题 -->
        <header class="text-center mb-8">
            <h1 class="text-[clamp(1.8rem,5vw,3rem)] font-game text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-orange-500 mb-3 animate-pulse-slow">
                能力卡牌大作战
            </h1>
            <p class="text-purple-200 max-w-2xl mx-auto text-lg">
                用你的10颗星星，兑换最想掌握的电商技能！看看班级最紧缺的技能是什么？
            </p>
        </header>
        
        <!-- 游戏状态区 -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div class="glass-effect rounded-xl p-4 w-full md:w-auto flex items-center">
                <i class="fa fa-star text-secondary text-2xl mr-3 animate-shine"></i>
                <div>
                    <p class="text-sm text-purple-200">剩余星星</p>
                    <p id="stars-remaining" class="text-3xl font-bold text-secondary">10</p>
                </div>
            </div>
            
            <div class="glass-effect rounded-xl p-4 w-full md:w-auto flex items-center">
                <i class="fa fa-users text-blue-300 text-2xl mr-3"></i>
                <div>
                    <p class="text-sm text-purple-200">参与人数</p>
                    <p id="participants-count" class="text-3xl font-bold text-blue-300">0</p>
                </div>
            </div>
            
            <div class="glass-effect rounded-xl p-4 w-full md:w-auto flex items-center">
                <i class="fa fa-check-circle text-green-300 text-2xl mr-3"></i>
                <button id="submit-vote" class="text-green-300 hover:text-green-200 transition-colors opacity-50 cursor-not-allowed" disabled>
                    <p class="text-sm text-purple-200">完成后点击</p>
                    <p class="font-bold">提交投票</p>
                </button>
            </div>
        </div>
        
        <!-- 主要游戏区 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 左侧：卡牌区 -->
            <div class="lg:col-span-2">
                <div class="glass-effect rounded-xl p-5 mb-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-th-large text-yellow-400 mr-2"></i> 电商技能卡牌库
                    </h2>
                    <p class="text-sm text-purple-200 mb-4">
                        点击卡牌分配星星，每张卡牌最多可分配5颗星星，总共10颗星星可分配
                    </p>
                    
                    <!-- 投票完成提示（默认隐藏） -->
                    <div id="voting-complete" class="hidden bg-green-500/20 border border-green-500/40 rounded-lg p-4 mb-4 text-center">
                        <i class="fa fa-check-circle text-green-400 text-xl mr-2"></i>
                        <span>你的投票已提交成功！查看右侧班级排行榜。</span>
                    </div>
                    
                    <!-- 卡牌网格 -->
                    <div id="cards-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[70vh] overflow-y-auto pr-2">
                        <!-- 卡牌将通过JS动态生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 右侧：排行榜 -->
            <div>
                <div class="glass-effect rounded-xl p-5 sticky top-4">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa fa-trophy text-yellow-500 mr-2"></i> 班级最紧缺技能排行榜
                    </h2>
                    <p class="text-sm text-purple-200 mb-4">
                        获得星星越多，表示该技能越被班级需要
                    </p>
                    
                    <!-- 排行榜图表 -->
                    <div class="h-64 mb-6">
                        <canvas id="rankings-chart"></canvas>
                    </div>
                    
                    <!-- 排行榜列表 -->
                    <div id="rankings-list" class="space-y-2 max-h-[40vh] overflow-y-auto pr-2">
                        <!-- 排行榜将通过JS动态生成 -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 游戏说明 -->
        <div class="glass-effect rounded-xl p-5 mt-8">
            <h3 class="text-lg font-bold mb-3 flex items-center">
                <i class="fa fa-info-circle text-blue-400 mr-2"></i> 游戏规则
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-purple-100">
                <div>
                    <p class="mb-2"><span class="text-yellow-300 font-semibold">1.</span> 每位同学有10颗星星可分配，且只能投票一次</p>
                    <p class="mb-2"><span class="text-yellow-300 font-semibold">2.</span> 点击技能卡牌为其分配星星</p>
                    <p class="mb-2"><span class="text-yellow-300 font-semibold">3.</span> 每张卡牌最多可分配5颗星星</p>
                </div>
                <div>
                    <p class="mb-2"><span class="text-yellow-300 font-semibold">4.</span> 再次点击可减少分配的星星</p>
                    <p class="mb-2"><span class="text-yellow-300 font-semibold">5.</span> 星星分配完毕后点击"提交投票"</p>
                    <p><span class="text-yellow-300 font-semibold">6.</span> 提交后不可修改，排行榜实时更新</p>
                </div>
            </div>
        </div>
        
        <!-- 页脚 -->
        <footer class="text-center text-purple-400 text-sm mt-10 opacity-70">
            <p>电商技能培养计划 &copy; 2023 | 能力卡牌大作战</p>
        </footer>
    </div>

    <script>
        // 电商技能卡牌数据
        const skillCards = [
            { id: 1, name: "Excel高级应用", icon: "fa-table", category: "数据处理" },
            { id: 2, name: "Premiere剪辑", icon: "fa-film", category: "多媒体" },
            { id: 3, name: "Python基础", icon: "fa-code", category: "编程" },
            { id: 4, name: "商务谈判", icon: "fa-handshake-o", category: "沟通" },
            { id: 5, name: "文案写作", icon: "fa-pencil", category: "内容创作" },
            { id: 6, name: "数据分析", icon: "fa-bar-chart", category: "数据处理" },
            { id: 7, name: "市场调研", icon: "fa-search", category: "市场" },
            { id: 8, name: "社交媒体运营", icon: "fa-share-alt", category: "营销" },
            { id: 9, name: "SEO优化", icon: "fa-search-plus", category: "营销" },
            { id: 10, name: "广告投放", icon: "fa-bullhorn", category: "营销" },
            { id: 11, name: "客户关系管理", icon: "fa-users", category: "客户服务" },
            { id: 12, name: "供应链管理", icon: "fa-truck", category: "运营" },
            { id: 13, name: "库存管理", icon: "fa-archive", category: "运营" },
            { id: 14, name: "产品摄影", icon: "fa-camera", category: "多媒体" },
            { id: 15, name: "PS图片处理", icon: "fa-picture-o", category: "多媒体" },
            { id: 16, name: "店铺装修", icon: "fa-building", category: "设计" },
            { id: 17, name: "直播带货", icon: "fa-video-camera", category: "销售" },
            { id: 18, name: "跨境电商操作", icon: "fa-globe", category: "平台操作" },
            { id: 19, name: "多平台运营", icon: "fa-exchange", category: "平台操作" },
            { id: 20, name: "活动策划", icon: "fa-calendar", category: "营销" },
            { id: 21, name: "品牌建设", icon: "fa-star-o", category: "营销" },
            { id: 22, name: "物流协调", icon: "fa-truck", category: "运营" },
            { id: 23, name: "数据报告制作", icon: "fa-file-text", category: "数据处理" },
            { id: 24, name: "用户画像分析", icon: "fa-user", category: "数据分析" },
            { id: 25, name: "竞品分析", icon: "fa-eye", category: "市场" },
            { id: 26, name: "客服技巧", icon: "fa-headphones", category: "客户服务" },
            { id: 27, name: "短视频制作", icon: "fa-film", category: "多媒体" },
            { id: 28, name: "内容营销", icon: "fa-newspaper-o", category: "营销" },
            { id: 29, name: "平台规则掌握", icon: "fa-book", category: "平台操作" },
            { id: 30, name: "电商法律法规", icon: "fa-gavel", category: "合规" }
        ];
        
        // 全局变量
        let userStars = {}; // 存储用户分配的星星 {cardId: stars}
        let totalStarsUsed = 0;
        const maxStarsPerCard = 5;
        const totalStarsAvailable = 10;
        let hasVoted = false; // 标记用户是否已投票
        let userContribution = {}; // 记录用户的最终贡献
        
        // 班级数据（实际应用中应从服务器获取）
        let classData = {};
        let participantsCount = 0;
        
        // DOM元素
        const cardsContainer = document.getElementById('cards-container');
        const rankingsList = document.getElementById('rankings-list');
        const starsRemainingEl = document.getElementById('stars-remaining');
        const participantsCountEl = document.getElementById('participants-count');
        const submitVoteBtn = document.getElementById('submit-vote');
        const votingCompleteEl = document.getElementById('voting-complete');
        let rankingsChart = null;
        
        // 初始化班级数据
        function initClassData() {
            skillCards.forEach(card => {
                classData[card.id] = {
                    name: card.name,
                    totalStars: 0,
                    icon: card.icon
                };
                userStars[card.id] = 0;
                userContribution[card.id] = 0;
            });
        }
        
        // 创建技能卡牌
        function createSkillCards() {
            cardsContainer.innerHTML = '';
            
            skillCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = `bg-gradient-to-br from-purple-800 to-indigo-900 rounded-lg overflow-hidden card-shadow card-hover ${hasVoted ? 'card-disabled' : ''}`;
                cardElement.dataset.cardId = card.id;
                
                cardElement.innerHTML = `
                    <div class="p-3 bg-purple-900/50 flex justify-between items-center">
                        <span class="text-xs text-purple-200">${card.category}</span>
                        <i class="fa ${card.icon} text-purple-300"></i>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-center mb-3 text-gray-100">${card.name}</h3>
                        <div class="flex justify-center mt-2">
                            <div class="star-container flex">
                                ${Array(5).fill(0).map((_, i) => `
                                    <i class="fa fa-star text-gray-600 ${userStars[card.id] > i ? 'star-active' : ''}" data-star-index="${i + 1}"></i>
                                `).join('')}
                            </div>
                        </div>
                        <div class="mt-3 text-center">
                            <span class="text-xs text-purple-300">已分配: </span>
                            <span class="text-secondary font-bold" id="stars-count-${card.id}">${userStars[card.id]}</span>
                        </div>
                    </div>
                `;
                
                // 未投票时添加点击事件
                if (!hasVoted) {
                    cardElement.addEventListener('click', () => handleCardClick(card.id));
                }
                
                cardsContainer.appendChild(cardElement);
            });
        }
        
        // 处理卡牌点击
        function handleCardClick(cardId) {
            if (hasVoted) return; // 已投票则不响应
            
            const currentStars = userStars[cardId] || 0;
            let newStars;
            
            // 点击逻辑：循环切换 0 → 1 → 2 → 3 → 4 → 5 → 0
            if (currentStars < maxStarsPerCard) {
                // 检查是否有足够的星星
                if (totalStarsUsed < totalStarsAvailable) {
                    newStars = currentStars + 1;
                    totalStarsUsed++;
                } else {
                    // 星星已用完，循环回到0
                    newStars = 0;
                    totalStarsUsed -= currentStars;
                }
            } else {
                // 已达到最大星星数，重置为0
                newStars = 0;
                totalStarsUsed -= currentStars;
            }
            
            // 更新用户星星数据
            userStars[cardId] = newStars;
            
            // 更新UI
            updateCardStars(cardId);
            updateStarsRemaining();
            updateSubmitButtonState();
        }
        
        // 更新卡牌星星显示
        function updateCardStars(cardId) {
            const starsCount = userStars[cardId];
            const cardElement = cardsContainer.querySelector(`[data-card-id="${cardId}"]`);
            
            // 更新星星显示
            cardElement.querySelectorAll('.star-container .fa-star').forEach((star, index) => {
                if (index < starsCount) {
                    star.classList.add('star-active');
                } else {
                    star.classList.remove('star-active');
                }
            });
            
            // 更新数字显示
            cardElement.querySelector(`#stars-count-${cardId}`).textContent = starsCount;
        }
        
        // 更新提交按钮状态
        function updateSubmitButtonState() {
            if (totalStarsUsed === totalStarsAvailable && !hasVoted) {
                submitVoteBtn.disabled = false;
                submitVoteBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                submitVoteBtn.classList.add('animate-shine');
            } else {
                submitVoteBtn.disabled = true;
                submitVoteBtn.classList.add('opacity-50', 'cursor-not-allowed');
                submitVoteBtn.classList.remove('animate-shine');
            }
        }
        
        // 更新剩余星星显示
        function updateStarsRemaining() {
            const remaining = totalStarsAvailable - totalStarsUsed;
            starsRemainingEl.textContent = remaining;
            
            // 添加动画效果
            starsRemainingEl.classList.add('animate-pulse');
            setTimeout(() => {
                starsRemainingEl.classList.remove('animate-pulse');
            }, 500);
        }
        
        // 提交投票
        function submitVote() {
            if (totalStarsUsed !== totalStarsAvailable || hasVoted) return;
            
            // 标记为已投票
            hasVoted = true;
            
            // 保存用户的最终贡献
            Object.keys(userStars).forEach(cardId => {
                userContribution[cardId] = userStars[cardId];
            });
            
            // 更新班级数据（添加当前用户的贡献）
            Object.keys(userContribution).forEach(cardId => {
                classData[cardId].totalStars += userContribution[cardId];
            });
            
            // 增加参与人数
            participantsCount++;
            participantsCountEl.textContent = participantsCount;
            
            // 更新UI状态
            submitVoteBtn.disabled = true;
            submitVoteBtn.classList.add('opacity-50', 'cursor-not-allowed');
            submitVoteBtn.classList.remove('animate-shine');
            votingCompleteEl.classList.remove('hidden');
            
            // 禁用所有卡牌
            document.querySelectorAll('#cards-container > div').forEach(card => {
                card.classList.add('card-disabled');
            });
            
            // 更新排行榜
            updateRankings();
        }
        
        // 更新排行榜
        function updateRankings() {
            // 排序技能
            const sortedSkills = Object.values(classData)
                .sort((a, b) => b.totalStars - a.totalStars)
                .slice(0, 10);
            
            // 更新排行榜列表
            rankingsList.innerHTML = '';
            
            sortedSkills.forEach((skill, index) => {
                const rankItem = document.createElement('div');
                rankItem.className = 'rank-item flex items-center p-2 rounded-lg hover:bg-purple-800/30';
                
                // 为前三名添加特殊样式
                let rankStyle = '';
                if (index === 0) rankStyle = 'bg-yellow-500 text-yellow-800';
                else if (index === 1) rankStyle = 'bg-gray-300 text-gray-800';
                else if (index === 2) rankStyle = 'bg-orange-600 text-white';
                else rankStyle = 'bg-gray-600 text-white';
                
                rankItem.innerHTML = `
                    <div class="w-6 h-6 rounded-full ${rankStyle} flex items-center justify-center text-xs font-bold mr-3">
                        ${index + 1}
                    </div>
                    <i class="fa ${skill.icon} text-purple-300 mr-3 w-5 text-center"></i>
                    <span class="flex-1 text-sm truncate">${skill.name}</span>
                    <div class="flex items-center">
                        <i class="fa fa-star text-secondary mr-1"></i>
                        <span class="font-bold">${skill.totalStars}</span>
                    </div>
                `;
                
                rankingsList.appendChild(rankItem);
            });
            
            // 更新排行榜图表
            updateRankingsChart(sortedSkills.slice(0, 5));
        }
        
        // 更新排行榜图表
        function updateRankingsChart(topSkills) {
            const ctx = document.getElementById('rankings-chart').getContext('2d');
            
            const labels = topSkills.map(skill => skill.name);
            const data = topSkills.map(skill => skill.totalStars);
            const backgroundColors = [
                'rgba(245, 158, 11, 0.8)', // 金色（第1名）
                'rgba(209, 213, 219, 0.8)', // 银色（第2名）
                'rgba(249, 115, 22, 0.8)', // 铜色（第3名）
                'rgba(168, 85, 247, 0.8)', // 紫色
                'rgba(34, 211, 238, 0.8)'  // 蓝色
            ];
            
            if (rankingsChart) {
                rankingsChart.destroy();
            }
            
            // 如果还没有数据，显示提示信息
            if (data.every(value => value === 0)) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.textAlign = 'center';
                ctx.font = '14px Inter, sans-serif';
                ctx.fillText('等待更多同学参与...', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            rankingsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '星星总数',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: backgroundColors.map(color => color.replace('0.8', '1')),
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }
        
        // 初始化事件监听
        function initEventListeners() {
            submitVoteBtn.addEventListener('click', submitVote);
        }
        
        // 初始化应用
        function init() {
            initClassData();
            createSkillCards();
            updateStarsRemaining();
            updateRankings();
            initEventListeners();
        }
        
        // 启动应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
