<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时投票系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        dark: '#1F2937',
                        light: '#F3F4F6'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .voting-animation {
                transition: all 0.3s ease;
            }
            .voting-animation:hover {
                transform: translateY(-5px);
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <header class="text-center mb-12">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-dark mb-4">实时投票系统</h1>
            <p class="text-gray-600 text-lg">多设备同步，实时更新排行榜</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- 投票区域 -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold mb-6 text-primary flex items-center">
                    <i class="fa fa-thumbs-up mr-2"></i>投票区
                </h2>
                <div id="candidates-list" class="space-y-4">
                    <!-- 候选人将通过JS动态生成 -->
                </div>
            </div>

            <!-- 排行榜区域 -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-2xl font-bold mb-6 text-accent flex items-center">
                    <i class="fa fa-trophy mr-2"></i>实时排行榜
                </h2>
                <div id="ranking-list" class="space-y-4">
                    <!-- 排行榜将通过JS动态生成 -->
                </div>
                <div class="mt-6 text-sm text-gray-500 text-center">
                    <p>数据每5秒自动更新一次</p>
                    <button id="refresh-btn" class="mt-2 text-primary hover:underline flex items-center mx-auto">
                        <i class="fa fa-refresh mr-1"></i> 立即刷新
                    </button>
                </div>
            </div>
        </div>

        <div class="mt-12 text-center text-gray-500 text-sm">
            <p>多设备同步：在任何设备上投票，所有设备都会实时更新</p>
        </div>
    </div>

    <script>
        // 候选人数据
        let candidatesData = [
            { id: 1, name: "候选人A", votes: 0, avatar: "https://picsum.photos/id/1005/100/100" },
            { id: 2, name: "候选人B", votes: 0, avatar: "https://picsum.photos/id/1012/100/100" },
            { id: 3, name: "候选人C", votes: 0, avatar: "https://picsum.photos/id/1027/100/100" }
        ];

        // 初始化：从本地存储加载数据（模拟服务器存储）
        function initData() {
            const savedData = localStorage.getItem('votingData');
            if (savedData) {
                candidateData = JSON.parse(savedData);
            } else {
                saveData(); // 保存初始数据
            }
            renderCandidates();
            renderRanking();
        }

        // 保存数据到本地存储（模拟发送到服务器）
        function saveData() {
            localStorage.setItem('votingData', JSON.stringify(candidateData));
            
            // 模拟向服务器发送数据
            simulateServerSync().then(() => {
                console.log('数据已同步到服务器');
            });
        }

        // 从"服务器"获取最新数据（模拟）
        function fetchLatestData() {
            return new Promise((resolve) => {
                // 模拟网络请求延迟
                setTimeout(() => {
                    // 从本地存储获取（实际应用中这里会是API请求）
                    const latestData = localStorage.getItem('votingData');
                    resolve(latestData ? JSON.parse(latestData) : candidateData);
                }, 300);
            });
        }

        // 模拟与服务器同步
        function simulateServerSync() {
            return new Promise((resolve) => {
                // 模拟网络请求
                setTimeout(resolve, 500);
            });
        }

        // 渲染候选人列表
        function renderCandidates() {
            const container = document.getElementById('candidate-list');
            container.innerHTML = '';
            
            candidateData.forEach(candidate => {
                const candidateEl = document.createElement('div');
                candidateEl.className = 'flex items-center p-4 border border-gray-100 rounded-lg voting-animation hover:border-primary';
                candidateEl.innerHTML = `
                    <img src="${candidate.avatar}" alt="${candidate.name}的头像" class="w-16 h-16 rounded-full mr-4 object-cover">
                    <div class="flex-1">
                        <h3 class="font-bold text-lg">${candidate.name}</h3>
                        <p class="text-gray-500">得票数: ${candidate.votes}</p>
                    </div>
                    <button onclick="vote(${candidate.id})" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition">
                        <i class="fa fa-vote-yea mr-1"></i> 投票
                    </button>
                `;
                container.appendChild(candidateEl);
            });
        }

        // 渲染排行榜
        function renderRanking() {
            const container = document.getElementById('ranking-list');
            container.innerHTML = '';
            
            // 按票数排序
            const sortedCandidates = [...candidateData].sort((a, b) => b.votes - a.votes);
            
            sortedCandidates.forEach((candidate, index) => {
                const rankingEl = document.createElement('div');
                // 根据排名添加不同样式
                let rankClass = '';
                let rankIcon = '';
                
                if (index === 0) {
                    rankClass = 'bg-yellow-50 border-yellow-200';
                    rankIcon = '<i class="fa fa-crown text-yellow-500 mr-2"></i>';
                } else if (index === 1) {
                    rankClass = 'bg-gray-50 border-gray-200';
                    rankIcon = '<i class="fa fa-medal text-gray-400 mr-2"></i>';
                } else if (index === 2) {
                    rankClass = 'bg-orange-50 border-orange-200';
                    rankIcon = '<i class="fa fa-award text-orange-600 mr-2"></i>';
                }
                
                rankingEl.className = `flex items-center p-4 border rounded-lg ${rankClass}`;
                rankingEl.innerHTML = `
                    <div class="font-bold text-xl w-8 text-center ${index < 3 ? 'text-primary' : 'text-gray-500'}">
                        ${index + 1}
                    </div>
                    <img src="${candidate.avatar}" alt="${candidate.name}的头像" class="w-12 h-12 rounded-full mx-4 object-cover">
                    <div class="flex-1">
                        <h3 class="font-bold">${rankIcon}${candidate.name}</h3>
                    </div>
                    <div class="bg-light px-3 py-1 rounded-full font-bold text-dark">
                        ${candidate.votes} 票
                    </div>
                `;
                container.appendChild(rankingEl);
            });
        }

        // 投票功能
        function vote(candidateId) {
            const candidate = candidateData.find(c => c.id === candidateId);
            if (candidate) {
                candidate.votes++;
                saveData(); // 立即保存数据
                renderCandidates(); // 更新本地显示
                renderRanking();   // 更新排行榜
                
                // 显示投票成功动画
                showVoteSuccess();
            }
        }

        // 显示投票成功提示
        function showVoteSuccess() {
            // 创建提示元素
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 right-4 bg-secondary text-white px-4 py-2 rounded-lg shadow-lg z-50 transform transition-all duration-500 translate-y-10 opacity-0';
            toast.innerHTML = '<i class="fa fa-check mr-2"></i> 投票成功！';
            document.body.appendChild(toast);
            
            // 显示动画
            setTimeout(() => {
                toast.classList.remove('translate-y-10', 'opacity-0');
            }, 10);
            
            // 3秒后隐藏
            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 500);
            }, 3000);
        }

        // 刷新数据
        async function refreshData() {
            const latestData = await fetchLatestData();
            // 只有数据有变化时才更新UI
            if (JSON.stringify(latestData) !== JSON.stringify(candidateData)) {
                candidateData = latestData;
                renderCandidates();
                renderRanking();
                
                // 显示数据已更新提示
                showUpdateNotification();
            }
        }

        // 显示数据更新提示
        function showUpdateNotification() {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-accent text-white px-4 py-2 rounded-lg shadow-lg z-50 transform transition-all duration-500 translate-y-10 opacity-0';
            notification.innerHTML = '<i class="fa fa-sync mr-2"></i> 数据已更新';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-y-10', 'opacity-0');
            }, 10);
            
            setTimeout(() => {
                notification.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 2000);
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            initData();
            
            // 设置定时刷新（每5秒）
            setInterval(refreshData, 5000);
            
            // 立即刷新按钮
            document.getElementById('refresh-btn').addEventListener('click', refreshData);
        });
    </script>
</body>
</html>
